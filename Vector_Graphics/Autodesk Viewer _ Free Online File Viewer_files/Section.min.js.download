/*!
 * LMV v7.58.0
 *
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Forge Viewer Usage Limitations:
 *
 * The Autodesk Forge Viewer JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */(()=>{var t={83427:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var i=n(87537),o=n.n(i),r=n(23645),a=n.n(r)()(o());a.push([t.id,".sectionPanel{line-height:14px;text-align:left;z-index:10}.section-horizontal-divider{height:1px;border-top:1px solid rgba(200,200,200,0.8)}.section-submenu-select{display:block;position:relative;width:calc(100% - 40px);padding:10px 20px 0px 20px;opacity:0.3}.section-panel:hover .section-submenu-select{opacity:0.8}.section-submenu-selectlabel{position:relative;display:inline-block;padding-right:20px;padding-bottom:4px}.section-restart{margin:10px 20px 15px 20px;padding:6px 10px 6px 10px;width:calc(100% - 55px);cursor:pointer}.docking-panel:hover .section-restart{background-color:rgba(255,255,255,0.12)}.docking-panel .section-restart:hover{background-color:rgba(166,194,255,0.7);-webkit-transition:all 0.2s ease;-moz-transition:all 0.2s ease;-ms-transition:all 0.2s ease;-o-transition:all 0.2s ease;transition:all 0.2s ease}\n","",{version:3,sources:["webpack://./extensions/Section/Section.css"],names:[],mappings:"AAGA,cACI,gBAAiB,CACjB,eAAgB,CAChB,UAAW,CACd,4BAIG,UAAW,CACX,0CAA2C,CAC9C,wBAIG,aAAc,CACd,iBAAkB,CAClB,uBAAwB,CACxB,0BAA2B,CAC3B,WAAY,CACf,6CAGE,WAAY,CACd,6BAIG,iBAAkB,CAClB,oBAAsB,CACtB,kBAAoB,CACpB,kBAAoB,CACvB,iBAGG,0BAA2B,CAC3B,yBAA0B,CAC1B,uBAAwB,CACxB,cAAe,CAClB,sCAGG,uCAAwC,CAC3C,sCAGG,sCAAwC,CACxC,gCAAiC,CACjC,6BAA8B,CAC9B,4BAA6B,CAC7B,2BAA4B,CAC5B,wBAAyB",sourcesContent:["/**\n * Section CSS\n **/\n.sectionPanel {\n    line-height: 14px;\n    text-align: left;\n    z-index: 10;\n}\n\n.section-horizontal-divider\n{\n    height: 1px;\n    border-top: 1px solid rgba(200,200,200,0.8);\n}\n\n.section-submenu-select\n{\n    display: block;\n    position: relative;\n    width: calc(100% - 40px);\n    padding: 10px 20px 0px 20px;\n    opacity: 0.3;\n}\n\n.section-panel:hover .section-submenu-select {\n   opacity: 0.8;\n}\n\n.section-submenu-selectlabel\n{\n    position: relative;\n    display:  inline-block;\n    padding-right:  20px;\n    padding-bottom:  4px;\n}\n\n.section-restart {\n    margin: 10px 20px 15px 20px;\n    padding: 6px 10px 6px 10px;\n    width: calc(100% - 55px);\n    cursor: pointer;\n}\n\n.docking-panel:hover .section-restart {\n    background-color: rgba(255,255,255, .12);\n}\n\n.docking-panel .section-restart:hover {\n    background-color: rgba(166,194,255, 0.7);\n    -webkit-transition: all 0.2s ease;\n    -moz-transition: all 0.2s ease;\n    -ms-transition: all 0.2s ease;\n    -o-transition: all 0.2s ease;\n    transition: all 0.2s ease;\n}\n\n"],sourceRoot:""}]);const s=a},23645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);i&&a[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),e.push(u))}},e}},87537:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),r="/*# ".concat(o," */"),a=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(a).concat([r]).join("\n")}return[e].join("\n")}},62705:(t,e,n)=>{var i=n(55639).Symbol;t.exports=i},44239:(t,e,n)=>{var i=n(62705),o=n(89607),r=n(2333),a=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?o(t):r(t)}},27561:(t,e,n)=>{var i=n(67990),o=/^\s+/;t.exports=function(t){return t?t.slice(0,i(t)+1).replace(o,""):t}},31957:(t,e,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=i},89607:(t,e,n)=>{var i=n(62705),o=Object.prototype,r=o.hasOwnProperty,a=o.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=r.call(t,s),n=t[s];try{t[s]=void 0;var i=!0}catch(t){}var o=a.call(t);return i&&(e?t[s]=n:delete t[s]),o}},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},55639:(t,e,n)=>{var i=n(31957),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();t.exports=r},67990:t=>{var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},23279:(t,e,n)=>{var i=n(13218),o=n(7771),r=n(14841),a=Math.max,s=Math.min;t.exports=function(t,e,n){var c,l,u,h,p,E,d=0,f=!1,v=!1,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=c,i=l;return c=l=void 0,d=e,h=t.apply(i,n)}function w(t){return d=t,p=setTimeout(g,e),f?y(t):h}function T(t){var n=t-E;return void 0===E||n>=e||n<0||v&&t-d>=u}function g(){var t=o();if(T(t))return R(t);p=setTimeout(g,function(t){var n=e-(t-E);return v?s(n,u-(t-d)):n}(t))}function R(t){return p=void 0,m&&c?y(t):(c=l=void 0,h)}function x(){var t=o(),n=T(t);if(c=arguments,l=this,E=t,n){if(void 0===p)return w(E);if(v)return clearTimeout(p),p=setTimeout(g,e),y(E)}return void 0===p&&(p=setTimeout(g,e)),h}return e=r(e)||0,i(n)&&(f=!!n.leading,u=(v="maxWait"in n)?a(r(n.maxWait)||0,e):u,m="trailing"in n?!!n.trailing:m),x.cancel=function(){void 0!==p&&clearTimeout(p),d=0,c=E=l=p=void 0},x.flush=function(){return void 0===p?h:R(o())},x}},13218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},37005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},33448:(t,e,n)=>{var i=n(44239),o=n(37005);t.exports=function(t){return"symbol"==typeof t||o(t)&&"[object Symbol]"==i(t)}},7771:(t,e,n)=>{var i=n(55639);t.exports=function(){return i.Date.now()}},14841:(t,e,n)=>{var i=n(27561),o=n(13218),r=n(33448),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(r(t))return NaN;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=i(t);var n=s.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):a.test(t)?NaN:+t}},93379:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var r={},a=[],s=0;s<t.length;s++){var c=t[s],l=i.base?c[0]+i.base:c[0],u=r[l]||0,h="".concat(l," ").concat(u);r[l]=u+1;var p=n(h),E={css:c[1],media:c[2],sourceMap:c[3]};-1!==p?(e[p].references++,e[p].updater(E)):e.push({identifier:h,updater:o(E,i),references:1}),a.push(h)}return a}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var r=i(t=t||[],o=o||{});return function(t){t=t||[];for(var a=0;a<r.length;a++){var s=n(r[a]);e[s].references--}for(var c=i(t,o),l=0;l<r.length;l++){var u=n(r[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=c}}},90569:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e),e}},3565:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i=n.css,o=n.media,r=n.sourceMap;o?t.setAttribute("media",o):t.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},44589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={id:i,exports:{}};return t[i](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=h(t);if(e){var o=h(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return l(this,n)}}function l(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?u(e):n}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}n.r(i),n.d(i,{SectionExtension:()=>_});var p=function(t,e,n){var i=t.distanceToPoint(e);return(n||new THREE.Vector3).copy(t.normal).multiplyScalar(i)};function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=y(t);if(e){var o=y(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return m(this,n)}}function m(t,e){return!e||"object"!==E(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}var w=n(23279),T=null,g=Autodesk.Viewing.Private,R=function(t,e){var n,i,s,l=t.impl,h=["section"],E=!1,m=!1,y=!1,R=!0,x=e.tintColor,b=e.tintIntensity,H=isNaN(e.gizmoOffsetRight)?200:e.gizmoOffsetRight,M=isNaN(e.gizmoOffsetLeft)?80:e.gizmoOffsetLeft,P=isNaN(e.gizmoOffsetTop)?80:e.gizmoOffsetTop,S=isNaN(e.gizmoOffsetBottom)?80:e.gizmoOffsetBottom,A=new THREE.Vector3,C=new THREE.Vector3,B=new THREE.Vector3,V=[],k=[],z=[],O="",I="gizmo",j=null,G=!1,X=!0,_=[0,1,1,3,3,2,2,0],Y=!0,Z=w((function(t,e,n){g.analytics.track("viewer.section",{from:t,type:e,action:n})}),2e3);function L(){l.invalidate(!1,!1,!0)}function D(){N(),n&&n.update(),i&&i.update()}function N(){if(n&&n.object){var t=l.worldToClient(n.position),e=l.getCanvasBoundingClientRect();if(A.copy(t),t.x<M?A.x=M:t.x>e.width-H&&(A.x=e.width-H),t.y<P?A.y=P:t.y>e.height-S&&(A.y=e.height-S),A.x!==t.x||A.y!==t.y){var i=THREE.TransformControls.intersectObjects(A.x,A.y,[n.object],l.camera,!1);if(i){var o=V[0].position;C.copy(n.object.position).add(o),B.copy(i.point).sub(C),n.setGizmoOffset(B)}}}}function F(){E&&1===k.length&&($(!0),D(),U((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)))}!function(){var t=function(t){a(n,THREE.MeshBasicMaterial);var e=c(n);function n(t){var i;return r(this,n),(i=e.call(this)).depthTest=!1,i.depthWrite=!1,i.side=THREE.FrontSide,i.transparent=!0,i.setValues(t),i.oldColor=i.color.clone(),i.oldOpacity=i.opacity,i.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)},i}return n}(),e=function(t){a(n,THREE.LineBasicMaterial);var e=c(n);function n(t){var i;return r(this,n),(i=e.call(this)).depthTest=!1,i.depthWrite=!1,i.transparent=!0,i.linewidth=1,i.setValues(t),i.oldColor=i.color.clone(),i.oldOpacity=i.opacity,i.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)},i}return n}(),n=function(t,e,n){var i=[];n=n||1;for(var o=0;o<=64*n;++o)"x"==e&&i.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(t)),"y"==e&&i.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(t)),"z"==e&&i.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(t));return(new THREE.BufferGeometry).setFromPoints(i)},i=function(t,e,n,i,o,r){return new THREE.CylinderBufferGeometry(t,e,n,i,o,r).applyMatrix4((new THREE.Matrix4).makeTranslation(0,.5,0))},s=function(t){var e=new THREE.Geometry;return"X"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===t&&e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),e},l=function(t){a(n,THREE.Object3D);var e=c(n);function n(t){var i;r(this,n);var o=u(i=e.call(this));return i.init=function(){this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var t=new THREE.PlaneBufferGeometry(50,50,2,2),e=new THREE.MeshBasicMaterial({wireframe:!0});e.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(t,e),YZ:new THREE.Mesh(t,e),XZ:new THREE.Mesh(t,e),XYZE:new THREE.Mesh(t,e)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse((function(t){if(t instanceof THREE.Mesh){t.updateMatrix();var e=t.geometry.clone();e.applyMatrix4(t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}}))},i.hide=function(){this.traverse((function(t){t.visible=!1}))},i.show=function(){this.traverse((function(t){t.visible=!0,t.parent!=o.pickers&&t.parent!=o.hemiPicker||(t.visible=!1),t.parent==o.planes&&(t.visible=!1)})),this.activePlane.visible=!1},i.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?e.material.highlight(!0):e.material.highlight(!1))}))},i.setupGizmos=function(){var e=function(t,e){for(var n in t)for(var i=t[n].length;i--;){var o=t[n][i][0],r=t[n][i][1],a=t[n][i][2],s=t[n][i][3];o.name=n,r&&o.position.set(r[0],r[1],r[2]),a&&o.rotation.set(a[0],a[1],a[2]),s&&(o.visble=s),e.add(o)}};if(this.setHandlePickerGizmos(),t)for(var n=Object.keys(this.handleGizmos),i=0;i<n.length;i++){var o=n[i];-1===t.indexOf(o)&&(delete this.handleGizmos[o],delete this.pickerGizmos[o],delete this.hemiPickerGizmos[o])}e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()},i}return o(n,[{key:"update",value:function(t,e){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse((function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(e,n,i)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(t))}))}}]),n}();THREE.TransformGizmo=l;var h=function(n){a(l,n);var o=c(l);function l(n){var a;return r(this,l),(a=o.call(this,n)).setHandlePickerGizmos=function(){var n=i(0,.05,.2,12,1,!1),o=s("X"),r=s("Y"),a=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(o,new e({color:15805484}))]],Y:[[new THREE.Mesh(n,new t({color:768011})),[0,.5,0]],[new THREE.Line(r,new e({color:768011}))]],Z:[[new THREE.Mesh(n,new t({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new e({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),new t({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),new t({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(1.2,1.2,1.2),new t({color:255})),[.5,.5,.5],null,!1]]}},a.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},a.init(),a}return l}(l);THREE.TransformGizmoTranslate=h;var p=function(i){a(s,i);var o=c(s);function s(i){var a;return r(this,s),(a=o.call(this,i)).setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(n(1,"x",.5),new e({color:16711680}))]],RY:[[new THREE.Line(n(1,"y",.5),new e({color:65280}))]],RZ:[[new THREE.Line(n(1,"z",.5),new e({color:255}))]],RE:[[new THREE.Line(n(1.25,"z",1),new e({color:65535}))]],RXYZE:[[new THREE.Line(n(1,"z",1),new e({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),new t({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,2,24),new t({color:16711935,opacity:.25}))]]}},a.setActivePlane=function(t){"RE"==t&&(this.activePlane=this.planes.XYZE),"RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},a.update=function(t,e){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,u=new THREE.Quaternion,h=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),h.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(r,Math.atan2(-h.y,h.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(a,Math.atan2(h.x,h.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(u.setFromAxisAngle(s,Math.atan2(h.y,h.x)),o.multiplyQuaternions(o,u),t.quaternion.copy(o))}))},a.init(),a}return s}(l);THREE.TransformGizmoRotate=p;var E=function(e){a(o,e);var n=c(o);function o(e){var a;r(this,o);var s=u(a=n.call(this,e));return a.setHandlePickerGizmos=function(){var e=i(0,.05,.2,12,1,!1),n=.15;this.handleGizmos={Z:[[new THREE.Mesh(e,new t({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.015,.015,.6,4,1,!1),new t({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.015,12,60,.3*Math.PI),new t({color:16711680})),[0,0,0],[n*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.05,.05,.015,60,1,!1),new t({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.015,12,60,.3*Math.PI),new t({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.05,.05,.01,60,1,!1),new t({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,.3*Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[n*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,.3*Math.PI),new t({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.02,12,60,2*Math.PI),new t({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.02,12,60,2*Math.PI),new t({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereBufferGeometry(1.2,8,8,0,Math.PI),new t({color:255})),null,null,!1]]}},a.setActivePlane=function(t,e,n){if("translate"==this.activeMode){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY));this.hide(),this.show()},a.update=function(t,e){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,u=new THREE.Quaternion,h=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),h.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(r,Math.atan2(-h.y,h.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(a,Math.atan2(h.x,h.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(u.setFromAxisAngle(s,Math.atan2(h.y,h.x)),o.multiplyQuaternions(o,u),t.quaternion.copy(o))}))}},a.show=function(){this.traverse((function(t){(null==s.parent||s.parent.useAllPickers||t.parent!=s.handles)&&(t.visible=!0),t.material&&(t.material.opacity=t.material.oldOpacity),t.parent!=s.pickers&&t.parent!=s.hemiPicker&&t.parent!=s.subPickers||(t.visible=!1),t.parent!=s.planes&&t.parent!=s.highlights||(t.visible=!1)})),this.activePlane.visible=!1},a.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?(e.parent!=s.highlights&&e.parent!=s.handles||(e.visible=!0),e.material.highlight(!0)):(e.material.highlight(!1),e.material.opacity=.1))}))},a.init(),a}return o}(l);THREE.TransformGizmoTranslateRotate=E;var d=function(n){a(l,n);var o=c(l);function l(n){var a;return r(this,l),(a=o.call(this,n)).setHandlePickerGizmos=function(){var n=i(.125,.125,.125),o=s("X"),r=s("Y"),a=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(o,new e({color:16711680}))]],Y:[[new THREE.Mesh(n,new t({color:65280})),[0,.5,0]],[new THREE.Line(r,new e({color:65280}))]],Z:[[new THREE.Mesh(n,new t({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new e({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new t({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),new t({color:16777215,opacity:.25}))]]}},a.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},a.init(),a}return l}(l);THREE.TransformGizmoScale=d;var f=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Raycaster,y=function(t){a(n,THREE.Object3D);var e=c(n);function n(t,i,o,a){var s;switch(r(this,n),s=e.call(this),i=void 0!==i?i:document,s.gizmo={},o){case"translate":s.gizmo[o]=new THREE.TransformGizmoTranslate(a);break;case"rotate":s.gizmo[o]=new THREE.TransformGizmoRotate(a);break;case"transrotate":s.gizmo[o]=new THREE.TransformGizmoTranslateRotate(a);break;case"scale":s.gizmo[o]=new THREE.TransformGizmoScale(a)}if(s.add(s.gizmo[o]),s.gizmo[o].hide(),s.object=void 0,s.snap=null,s.snapDelta=0,s.space="world",s.size=1,s.axis=null,s.useAllPickers=!0,s.unitX=new THREE.Vector3(1,0,0),s.unitY=new THREE.Vector3(0,1,0),s.unitZ=new THREE.Vector3(0,0,1),s.normal=new THREE.Vector3(0,0,1),"transrotate"===o){var c,l=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)],h=(new THREE.BufferGeometry).setFromPoints(l),p=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});s.startLine=new THREE.Line(h,p),l=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)],h=(new THREE.BufferGeometry).setFromPoints(l),p=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1}),s.endLine=new THREE.Line(h,p),l=[new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)],h=(new THREE.BufferGeometry).setFromPoints(l),p=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1}),s.centerLine=new THREE.Line(h,p),(c=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=c.minFilter=THREE.NearestFilter,h=new THREE.CircleBufferGeometry(.1,32),p=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:c}),s.centerMark=new THREE.Mesh(h,p),s.centerMark.rotation.set(Math.PI/2,0,0),s.ticks={},(c=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=c.minFilter=THREE.NearestFilter,p=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:c});var E=.25;s.ticks.RX=new THREE.Object3D,h=new THREE.PlaneBufferGeometry(.12,E);var d=new THREE.Mesh(h,p);d.position.set(0,0,-1.275),d.rotation.set(Math.PI/2,Math.PI/2,0),s.ticks.RX.add(d),(d=d.clone()).position.set(0,1.275,0),d.rotation.set(0,Math.PI/2,0),s.ticks.RX.add(d),(d=d.clone()).position.set(0,0,1.275),d.rotation.set(0,Math.PI/2,Math.PI/2),s.ticks.RX.add(d),(d=d.clone()).position.set(0,-1.275,0),d.rotation.set(0,Math.PI/2,0),s.ticks.RX.add(d),s.ticks.RY=new THREE.Object3D,(d=d.clone()).position.set(0,0,-1.275),d.rotation.set(Math.PI/2,0,0),s.ticks.RY.add(d),(d=d.clone()).position.set(-1.275,0,0),d.rotation.set(Math.PI/2,0,Math.PI/2),s.ticks.RY.add(d),(d=d.clone()).position.set(0,0,1.275),d.rotation.set(Math.PI/2,0,0),s.ticks.RY.add(d),(d=d.clone()).position.set(1.275,0,0),d.rotation.set(Math.PI/2,0,Math.PI/2),s.ticks.RY.add(d)}var f=u(s),v=!1,m=o,y={type:"change"},w={type:"mouseDown"},T={type:"mouseUp",mode:m},g={type:"objectChange"},R=new THREE.Vector3,x=new THREE.Vector3,b=new THREE.Vector3,H=new THREE.Vector3,M=1;s.clientScale=1;var P=new THREE.Matrix4,S=new THREE.Vector3,A=new THREE.Matrix4,C=new THREE.Vector3,B=new THREE.Quaternion,V=new THREE.Vector3,k=new THREE.Vector3,z=new THREE.Vector3,O=new THREE.Quaternion,I=new THREE.Quaternion,j=new THREE.Quaternion,G=new THREE.Quaternion,X=new THREE.Quaternion,_=new THREE.Vector3,Y=new THREE.Vector3,Z=new THREE.Matrix4,L=new THREE.Matrix4,D=new THREE.Vector3,N=new THREE.Vector3,F=new THREE.Euler,W=new THREE.Matrix4,U=new THREE.Vector3;function Q(e,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,n,t,!0)}return new THREE.Euler,s.attach=function(t){f.object=t,this.gizmo[m].show(),f.update(),f.updateUnitVectors()},s.detach=function(t){f.object=void 0,this.axis=null,this.gizmo[m].hide()},s.setMode=function(t){"scale"==(m=t||m)&&(f.space="local"),this.gizmo[m].show(),this.update(),f.dispatchEvent(y)},s.getPicker=function(){return f.gizmo[m].hemiPicker.children},s.setPosition=function(t){this.object.position.copy(t),this.update()},s.setNormal=function(t){B.setFromUnitVectors(this.normal,t),this.unitX.applyQuaternion(B),this.unitY.applyQuaternion(B),this.unitZ.applyQuaternion(B),this.normal.copy(t),this.object&&this.object.quaternion.multiply(B),this.update()},s.setRotation=function(t){this.object&&(this.object.quaternion.setFromRotationMatrix(t),this.update(),this.updateUnitVectors())},s.setSnap=function(t,e){f.snap=t,f.snapDelta=e},s.setSize=function(t){f.size=t,this.update(),f.dispatchEvent(y)},s.setSpace=function(t){f.space=t,this.update(),f.dispatchEvent(y)},s.update=function(e){if(void 0!==f.object){var n;if(f.object.updateMatrixWorld(),N.setFromMatrixPosition(f.object.matrixWorld),F.setFromRotationMatrix(A.extractRotation(f.object.matrixWorld)),t.updateMatrixWorld(),U.setFromMatrixPosition(t.matrixWorld),this.position.copy(N),this.quaternion.setFromEuler(F),this.normal.set(0,0,1),this.normal.applyEuler(F),t.isPerspective){var o=N.distanceTo(U);n=2*Math.tan(t.fov*Math.PI/360)*o}else n=t.top-t.bottom;var r=i.getBoundingClientRect();M=100*this.clientScale*n/r.height,this.scale.set(M,M,M),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),e&&this.gizmo[m].highlight(f.axis)}},s.setGizmoOffset=function(t){this.gizmoOffset=t||new THREE.Vector3(0,0,0),this.update()},s.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(F),this.unitY.applyEuler(F),this.unitZ.applyEuler(F)},s.showRotationGizmos=function(t){for(var e=this.gizmo[m].handles.children,n=0;n<e.length;n++){var i=e[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=t)}this.useAllPickers=t},s.highlight=function(){this.gizmo[m].highlight(this.axis||"Z")},s.onPointerHover=function(t){if(void 0===f.object||!0===v)return!1;var e=Q(t,f.useAllPickers?f.gizmo[m].pickers.children:f.gizmo[m].subPickers.children),n=null,i="";return e&&(i=-1!=(n=e.object.name).search("R")?"rotate":"translate"),f.axis!==n&&(f.axis=n,f.gizmo[m].activeMode=i,f.update(!0),f.dispatchEvent(y)),null===f.axis&&f.gizmo[m].show(),!!e},s.isDragging=function(){return v},s.onPointerDown=function(e){if(void 0===f.object||!0===v)return!1;var n=e;if("touch"===e.pointerType){var i=null,o="";(r=Q(n,f.useAllPickers?f.gizmo[m].pickers.children:f.gizmo[m].subPickers.children))&&(o=-1!=(i=r.object.name).search("R")?"rotate":"translate"),f.axis!==i&&(f.axis=i,f.gizmo[m].activeMode=o)}var r=null;if((0===n.button||-1===n.button||void 0===n.button)&&(r=Q(n,f.useAllPickers?f.gizmo[m].pickers.children:f.gizmo[m].subPickers.children))){f.dispatchEvent(w),f.axis=r.object.name,f.update(),S.copy(t.position).sub(N).normalize(),f.gizmo[m].setActivePlane(f.axis,S,"local"===f.space);var a=Q(n,[f.gizmo[m].activePlane]);if(a&&x.copy(a.point),_.copy(f.object.position),Y.copy(f.object.scale),Z.extractRotation(f.object.matrix),W.extractRotation(f.object.matrixWorld),f.object.parent?(L.extractRotation(f.object.parent.matrixWorld),D.setFromMatrixScale(A.copy(f.object.parent.matrixWorld).invert())):(L.extractRotation(f.object.matrixWorld),D.setFromMatrixScale(A.copy(f.object.matrixWorld).invert())),"transrotate"===m&&"rotate"===f.gizmo[m].activeMode){var s=f.startLine.geometry.getAttribute("position");s.setXYZ(0,0,0,0),s.setXYZ(1,0,0,1),s.applyMatrix4(f.matrixWorld),s.needsUpdate=!0,f.parent.add(f.startLine);var c=f.object.geometry.getAttribute("position"),l=(new THREE.Vector3).fromBufferAttribute(c,0).applyMatrix4(f.object.matrixWorld),u=(new THREE.Vector3).fromBufferAttribute(c,1).applyMatrix4(f.object.matrixWorld),h=(new THREE.Vector3).fromBufferAttribute(c,2).applyMatrix4(f.object.matrixWorld),p=(new THREE.Vector3).fromBufferAttribute(c,3).applyMatrix4(f.object.matrixWorld),E=f.centerLine.geometry.getAttribute("position");if("RX"===f.axis){l.lerp(h,.5),u.lerp(p,.5);var d=l.distanceTo(u);f.centerLine.material.dashSize=d/15,f.centerLine.material.gapSize=d/30,E.setXYZ(0,l.x,l.y,l.z),E.setXYZ(1,u.x,u.y,u.z)}else l.lerp(u,.5),h.lerp(p,.5),d=l.distanceTo(h),f.centerLine.material.dashSize=d/15,f.centerLine.material.gapSize=d/30,E.setXYZ(0,l.x,l.y,l.z),E.setXYZ(1,h.x,h.y,h.z);f.centerLine.computeLineDistances(),E.needsUpdate=!0,f.parent.add(f.centerLine),f.ticks[f.axis].position.copy(f.position),f.ticks[f.axis].quaternion.copy(f.quaternion),f.ticks[f.axis].scale.copy(f.scale),f.parent.add(f.ticks[f.axis])}}return v=!0,!!r},s.onPointerMove=function(t){if(void 0===f.object||null===f.axis||!1===v)return!1;var e=Q(t,[f.gizmo[m].activePlane]);e&&R.copy(e.point);var n=f.gizmo[m].activeMode;if("translate"==n)R.sub(x),R.multiply(D),"local"==f.space&&(R.applyMatrix4(A.copy(W).invert()),-1==f.axis.search("X")&&(R.x=0),-1==f.axis.search("Y")&&(R.y=0),-1==f.axis.search("Z")&&(R.z=0),R.applyMatrix4(Z),f.object.position.copy(_),f.object.position.add(R)),"world"!=f.space&&-1==f.axis.search("XYZ")||(V.copy(this.unitX),k.copy(this.unitY),z.copy(this.unitZ),C.set(0,0,0),-1!=f.axis.search("X")&&(V.multiplyScalar(R.dot(this.unitX)),C.add(V)),-1!=f.axis.search("Y")&&(k.multiplyScalar(R.dot(this.unitY)),C.add(k)),-1!=f.axis.search("Z")&&(z.multiplyScalar(R.dot(this.unitZ)),C.add(z)),R.copy(C),R.applyMatrix4(A.copy(L).invert()),f.object.position.copy(_),f.object.position.add(R));else if("scale"==n)R.sub(x),R.multiply(D),"local"==f.space&&("XYZ"==f.axis?(M=1+R.y/50,f.object.scale.x=Y.x*M,f.object.scale.y=Y.y*M,f.object.scale.z=Y.z*M):(R.applyMatrix4(A.copy(W).invert()),"X"==f.axis&&(f.object.scale.x=Y.x*(1+R.x/50)),"Y"==f.axis&&(f.object.scale.y=Y.y*(1+R.y/50)),"Z"==f.axis&&(f.object.scale.z=Y.z*(1+R.z/50))));else if("rotate"==n){if(R.sub(N),R.multiply(D),C.copy(x).sub(N),C.multiply(D),"RE"==f.axis){A.copy(P).invert(),R.applyMatrix4(A),C.applyMatrix4(A),b.set(Math.atan2(R.z,R.y),Math.atan2(R.x,R.z),Math.atan2(R.y,R.x)),H.set(Math.atan2(C.z,C.y),Math.atan2(C.x,C.z),Math.atan2(C.y,C.x)),B.setFromRotationMatrix(A.copy(L).invert());var i=b.z-H.z;if(null!==f.snap){var o=Math.round(i/f.snap)*f.snap;Math.abs(o-i)<f.snapDelta&&(i=o)}X.setFromAxisAngle(S,i),O.setFromRotationMatrix(W),B.multiplyQuaternions(B,X),B.multiplyQuaternions(B,O),f.object.quaternion.copy(B)}else if("RXYZE"==f.axis){var r=R.clone().cross(C).normalize();B.setFromRotationMatrix(A.copy(L).invert());var a=-R.clone().angleTo(C);null!==f.snap&&(o=Math.round(a/f.snap)*f.snap,Math.abs(o-a)<f.snapDelta&&(a=o)),I.setFromAxisAngle(r,a),O.setFromRotationMatrix(W),B.multiplyQuaternions(B,I),B.multiplyQuaternions(B,O),f.object.quaternion.copy(B)}else if("local"==f.space){A.copy(W).invert(),R.applyMatrix4(A),C.applyMatrix4(A);var s=R.dot(this.unitX),c=R.dot(this.unitY),l=R.dot(this.unitZ),u=C.dot(this.unitX),h=C.dot(this.unitY),p=C.dot(this.unitZ);b.set(Math.atan2(l,c),Math.atan2(s,l),Math.atan2(c,s)),H.set(Math.atan2(p,h),Math.atan2(u,p),Math.atan2(h,u));var E=b.x-H.x,d=b.y-H.y;i=b.z-H.z,null!==f.snap&&(-1!=f.axis.search("X")&&(o=Math.round(E/f.snap)*f.snap,Math.abs(o-E)<f.snapDelta&&(E=o)),-1!=f.axis.search("Y")&&(o=Math.round(d/f.snap)*f.snap,Math.abs(o-d)<f.snapDelta&&(d=o)),-1!=f.axis.search("Z")&&(o=Math.round(i/f.snap)*f.snap,Math.abs(o-i)<f.snapDelta&&(i=o))),I.setFromAxisAngle(this.unitX,E),j.setFromAxisAngle(this.unitY,d),G.setFromAxisAngle(this.unitZ,i),O.setFromRotationMatrix(Z),"RX"==f.axis&&O.multiplyQuaternions(O,I),"RY"==f.axis&&O.multiplyQuaternions(O,j),"RZ"==f.axis&&O.multiplyQuaternions(O,G),f.object.quaternion.copy(O)}else"world"==f.space&&(s=R.dot(this.unitX),c=R.dot(this.unitY),l=R.dot(this.unitZ),u=C.dot(this.unitX),h=C.dot(this.unitY),p=C.dot(this.unitZ),b.set(Math.atan2(l,c),Math.atan2(s,l),Math.atan2(c,s)),H.set(Math.atan2(p,h),Math.atan2(u,p),Math.atan2(h,u)),B.setFromRotationMatrix(A.copy(L).invert()),E=b.x-H.x,d=b.y-H.y,i=b.z-H.z,null!==f.snap&&(-1!=f.axis.search("X")&&(o=Math.round(E/f.snap)*f.snap,Math.abs(o-E)<f.snapDelta&&(E=o)),-1!=f.axis.search("Y")&&(o=Math.round(d/f.snap)*f.snap,Math.abs(o-d)<f.snapDelta&&(d=o)),-1!=f.axis.search("Z")&&(o=Math.round(i/f.snap)*f.snap,Math.abs(o-i)<f.snapDelta&&(i=o))),I.setFromAxisAngle(this.unitX,E),j.setFromAxisAngle(this.unitY,d),G.setFromAxisAngle(this.unitZ,i),O.setFromRotationMatrix(W),"RX"==f.axis&&B.multiplyQuaternions(B,I),"RY"==f.axis&&B.multiplyQuaternions(B,j),"RZ"==f.axis&&B.multiplyQuaternions(B,G),B.multiplyQuaternions(B,O),f.object.quaternion.copy(B));"transrotate"===m&&(f.add(f.endLine),f.add(f.centerMark))}return f.object.matrixAutoUpdate=!0,f.update(!0),f.dispatchEvent(y),f.dispatchEvent(g),!!e},s.onPointerUp=function(t){return v&&null!==f.axis&&(T.mode=m,f.dispatchEvent(T)),v=!1,this.gizmo[m].show(),this.updateUnitVectors(),"transrotate"===m&&"rotate"===this.gizmo[m].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1},s}return o(n,null,[{key:"intersectObjects",value:function(t,e,n,i,o){var r=t/i.clientWidth*2-1,a=-e/i.clientHeight*2+1;i.isPerspective?(f.set(r,a,.5),f.unproject(i),m.set(i.position,f.sub(i.position).normalize())):(f.set(r,a,-1),f.unproject(i),v.set(0,0,-1),m.set(f,v.transformDirection(i.matrixWorld)));var s=m.intersectObjects(n,o);return s[0]?s[0]:null}}]),n}();THREE.TransformControls=y}(),function(){if(T)return;var t=new THREE.Vector3,e=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(a,THREE.Mesh);var n,i,o,r=v(a);function a(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(i=r.call(this,t,e,!1)).plane=n,i.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),i.connectivity=[],i.outline=null,i}return n=a,(i=[{key:"update",value:function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var e=this.plane.normal,n=-1*this.getWorldPosition(t).dot(e);this.planeVec.set(e.x,e.y,e.z,n),this.plane.constant=n}}])&&d(n.prototype,i),o&&d(n,o),a}();T=e}();var W=new function(t,e){var n,i,o,r,a,s,c,u=0,h=[],p=[];function E(t){u&&clearTimeout(u),u=0,i=t,h.length=0,p.length=0,r=null,a=-1,s=0,c=0}function d(){u=0;for(var r=performance.now()+t;performance.now()<r;){if(!m())return l.invalidate(!0,!0),void E(null);n(p[c],h[s],o,c+1>=p.length,!i||a>=i.length)}u=setTimeout(d,e)}function f(){if(i&&a<i.length)for(;++a<i.length;)if((r=i[a].getInstanceTree())&&(h.length=0,r.enumNodeChildren(i[a].getRootId(),(function(t){h.push(t)}),!0),h.length>0))return o=i[a];return o=null,!1}function v(){if(s>=h.length)return!1;for(;++s<h.length;){var t=h[s];if(!r.isNodeHidden(t)&&!r.isNodeOff(t)&&(p.length=0,r.enumNodeFragments(t,(function(t){p.push(t)}),!1),p.length>0))return!0}return!1}function m(){if(++c<p.length)return!0;for(c=0;;){if(v())return!0;if(!f())return!1;s=-1}}t=t||15,e=e||0,this.start=function(t,e,i){E(t),n=i,i&&(e>=0?u=setTimeout(d,e):d())}};function U(t){if(Y){var e=Autodesk.Viewing.Extensions.CompGeom;l.sceneAfter.skipDepthTarget=!0,dt();var n=new THREE.Object3D;n.name="section3D",l.scene.add(n);var i=new THREE.Object3D;i.name="section2D",l.sceneAfter.add(i);var o=e.makePlaneBasis(t),r=o.clone().invert(),a=l.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0,noIdOutput:!0},!1,!1),s=l.matman().findMaterial(null,a);s.transparent=!0,s.depthTest=!0,s.polygonOffset=!0,s.polygonOffsetFactor=-1,s.polygonOffsetUnits=.1,s.cutplanes=q;var c,u=new THREE.Box3,h=l.modelQueue().getModels().filter((function(t){return!t.getDoNotCut()})),p=[];W.start(h,50,(function(a,h,E,d){var f=E.getFragmentList();if(f.getWorldBounds(a,u),e.xBoxPlane(t,u)){var v=f.getVizmesh(a);v.geometry&&!v.geometry.is2d&&!v.geometry.isLines&&v.material.cutplanes&&(c=v.material,e.xMeshPlane(t,v,p))}if(d){if(p.length){var m=new THREE.Box3;e.convertToPlaneCoords(o,p,m);var y=new g.VertexBufferBuilder(!1,8*p.length),w=function(t){return t&&t.color||new THREE.Color(16777215)}(c),T=0|.25*w.r*255.5,R=0|.25*w.g*255.5,H=4278190080|(0|.25*w.b*255.5)<<16|R<<8|T,M=new e.EdgeSet(p,m,1e-6*m.getSize(new THREE.Vector3).length());M.snapEdges(),M.sanitizeEdges(),M.stitchContours();var P=M.triangulate();if(P){for(var S=0;S<P.contours.length;S++)for(var A=P.contours[S],C=1;C<A.length;C++){var B=P.pts[A[C-1]],V=P.pts[A[C]];y.addSegment(B.x,B.y,V.x,V.y,0,-2,H,h,0)}var k={mesh:y.toMesh()};g.BufferGeometryUtils.meshToGeometry(k);var z=k.geometry;z.streamingDraw=!0,z.streamingIndex=!0;var O=new THREE.Mesh(z,s);if(O.matrix.copy(r),O.matrixAutoUpdate=!1,O.frustumCulled=!1,O.modelId=E.id,O.dbId=h,i.add(O),!P.triangulationFailed){var I=P.toPolygonMesh(c.packedNormals),j=l.matman().cloneMaterial(c,E);j.packedNormals=c.packedNormals,j.cutplanes=q,j.side=THREE.FrontSide,j.depthTest=!0,j.map=null,j.bumpMap=null,j.normalMap=null,j.alphaMap=null,j.specularMap=null,j.transparent=!1,j.depthWrite=!0,j.hatchPattern=!0,j.needsUpdate=!0;var G=(c.id+2)*Math.PI*.125,X=Math.tan(G);j.hatchParams=new THREE.Vector2(X,10),j.hatchTintColor=x,j.hatchTintIntensity=b,null!=j.prismType&&(j.defines={},j.defines[j.prismType.toUpperCase()]="","PrismWood"==j.prismType&&(j.defines.NO_UVW=""));var _=new THREE.Mesh(I,j);_.matrix.copy(r),_.matrixAutoUpdate=!1,_.modelId=E.id,_.dbId=h,_.fragId=p.fragId,n.add(_)}}}p.length=0}}))}}var Q="Autodesk.Viewing.Extension.Section.SectionTool";l.setCutPlaneSetFor2DRendering(Q);var q=[];function J(t){function e(e){e&&e.traverse((function(e){e instanceof THREE.Mesh&&e.material&&(t?l.matman().adjustMaterialMRTSetting(e.material):e.material.needsUpdate=!0)}))}e(l.scene.getObjectByName("section3D")),e(l.sceneAfter.getObjectByName("section2D"))}function K(t,e){var n,i,o=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),t.normal);if(e){var r=t.projectPoint(e.max,new THREE.Vector3),a=t.projectPoint(e.min,new THREE.Vector3),s=o.clone().invert();r.applyQuaternion(s),a.applyQuaternion(s),i=(new THREE.Vector3).subVectors(r,a),n=new THREE.PlaneBufferGeometry(i.x,i.y)}else i=2*(e=l.getVisibleBounds()).getBoundingSphere(new THREE.Sphere).radius,n=new THREE.PlaneBufferGeometry(i,i);var c=new THREE.MeshBasicMaterial({opacity:0,color:2653930,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),u=new T(n,c,t),h=t.projectPoint(e.getCenter(new THREE.Vector3),new THREE.Vector3);u.position.copy(h),u.quaternion.multiply(o);var p=l.currentLightPreset();p=Math.max(0,p);var E=Autodesk.Viewing.Private.LightPresets[p].bgColorGradient,d="rgb("+(255-E[0])+","+(255-E[1])+","+(255-E[2])+")",f=new THREE.LineBasicMaterial({color:d,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0}),v=u.geometry.getAttribute("position");n=new THREE.Geometry;for(var m=0;m<_.length;m++)n.vertices.push((new THREE.Vector3).fromBufferAttribute(v,_[m]));var y=new THREE.Line(n,f);return u.add(y),u.outline=y,u}function $(t){tt((function(e){if(e instanceof T){var n;if(e.connectivity.length>0){var i=e.matrixWorld.clone().invert(),o=new THREE.Vector3;n=e.geometry.getAttribute("position");for(var r=0;r<n.count;r++){var a=e.connectivity[r];null!==pt(e.plane,a[0],a[1],o)&&(o.applyMatrix4(i),n.setXYZ(r,o.x,o.y,o.z))}n.needsUpdate=!0,e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()}else if(t){var s=l.getVisibleBounds(),c=2*s.getBoundingSphere(new THREE.Sphere).radius,u=e.plane.projectPoint(s.getCenter(new THREE.Vector3),new THREE.Vector3);e.geometry=new THREE.PlaneBufferGeometry(c,c),e.position.copy(u),n=e.geometry.getAttribute("position")}if(n){for(var h=0;h<_.length;h++)e.outline.geometry.vertices[h].fromBufferAttribute(n,_[h]);e.outline.geometry.verticesNeedUpdate=!0}}}))}function tt(t){for(var e=0;e<V.length;e++)V[e].traverse(t)}function et(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];tt((function(t){t instanceof T&&t.update()})),1===k.length&&U((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)),l.setCutPlaneSet(Q,k,t)}function nt(t){for(var e=0;e<V.length;e++)V[e].visible=t;R!==t&&L(),R=t}function it(t){t&&k.length>0&&(1===k.length&&U((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)),l.setCutPlaneSet(Q,k)),nt(t)}function ot(t,e){t.attach(e),t.setPosition(e.position),t.visible=!0}function rt(t){return l.api.navigation.getEyeVector().dot(t)>0&&t.negate(),t}function at(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=l.getVisibleBounds(),r=o.getCenter(new THREE.Vector3),a=new THREE.Group;e=void 0!==e?e:-1*r.dot(t);var s=new THREE.Plane(t,e),c=K(s,null);a.add(c),k.push(c.planeVec),V.push(a),l.addOverlay(I,a),n&&(ot(n,c),c.material.opacity=0,st(c),n.showRotationGizmos(!0),z=n.getPicker()),et(i),E&&D()}function st(t){if(!n||!t)return!1;var e=function(t){var e=new THREE.Vector3,n=t.geometry;return n.computeBoundingBox(),e.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,e.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,e.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,t.localToWorld(e),e}(t).sub(t.position);return e.sub(s),n.setGizmoOffset(e),!0}var ct,lt,ut,ht,pt=(ct=new THREE.Matrix3,lt=new THREE.Vector3,ut=new THREE.Vector3,ht=new THREE.Vector3,function(t,e,n,i){ct.set(t.normal.x,t.normal.y,t.normal.z,e.normal.x,e.normal.y,e.normal.z,n.normal.x,n.normal.y,n.normal.z);var o=ct.determinant();return 0===o?null:(lt.crossVectors(e.normal,n.normal).multiplyScalar(-t.constant),ut.crossVectors(n.normal,t.normal).multiplyScalar(-e.constant),ht.crossVectors(t.normal,e.normal).multiplyScalar(-n.constant),(i||new THREE.Vector3).copy(lt).add(ut).add(ht).divideScalar(o))}),Et=function(t,e,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,e,l.camera,n)};function dt(){var t=l.scene.getObjectByName("section3D");t&&l.scene.remove(t);var e=l.sceneAfter.getObjectByName("section2D");e&&l.sceneAfter.remove(e)}this.isActive=function(){return E},this.getSectionDistance=function(t){var e=l.api.navigation.getEyeVector(),n=l.rayIntersect(new THREE.Ray(l.camera.position,e));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(t)},this.setViewerSection=function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.clearSection(e);var i=l.getCutPlaneSet("__set_view");if(1===i.length){n.clientScale=1;var o=i[0];t=new THREE.Vector3(o.x,o.y,o.z);var r=o.w;at(t,r,e),O="SET_VIEW_PLANE",l.setCutPlaneSet("__set_view",void 0,e)}},this.setSection=function(t){var e,o;this.clearSection(),s=new THREE.Vector3,n.clientScale=1;var r=l.getCutPlaneSet("__set_view");switch(1===r.length&&"BOX"!==t&&"OBJ_SET_VIEW_PLANE"!==t&&(t="SET_VIEW_PLANE"),t){case"X":e=new THREE.Vector3(1,0,0),o=this.getSectionDistance(e),at(rt(e),o);break;case"Y":e=new THREE.Vector3(0,1,0),o=this.getSectionDistance(e),at(rt(e),o);break;case"Z":e=new THREE.Vector3(0,0,1),o=this.getSectionDistance(e),at(rt(e),o);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var a=r[0];at(e=new THREE.Vector3(a.x,a.y,a.z),a.w);break;case"OBJ_BOX":case"BOX":!function(t){var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],o=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],r=new THREE.Group,a=l.getVisibleBounds(),s=a.getCenter(new THREE.Vector3),c=new THREE.Box3(a.min,s),u=!1;t&&6===t.length&&1===t[0].x&&(s=(c=new THREE.Box3(new THREE.Vector3(t[3].w,t[4].w,t[5].w),new THREE.Vector3(t[0].w,t[1].w,t[2].w))).max.clone(),u=!0);var h,E,d,f=new THREE.Vector3,v=new THREE.Vector3,m=[],y=[];for(h=0;h<e.length;h++){if(u)d=new THREE.Plane(e[h],t[h].w),m.push(d);else if(d=new THREE.Plane(e[h],-1*s.dot(e[h])),m.push(d),h>2){p(d,c.max,f),p(d,c.min,v);var w=(new THREE.Vector3).subVectors(f,v);d.constant-=w.length()}E=K(d,c),r.add(E),y.push(E),k.push(E.planeVec)}for(h=0;h<y.length;h++){E=y[h];for(var T=o[h],g=0;g<T.length;g++){for(var R=[],x=T[g],b=0;b<x.length;b++)R.push(m[x[b]]);E.connectivity.push(R)}}V.push(r),l.addOverlay(I,r),et(),$(),d=V[0].children[0],ot(n,d),d.material.opacity=.25,st(d),ot(i,V[0]),n.showRotationGizmos(!1),z=n.getPicker().concat(i.getPicker());var H=V[0].position.clone().sub(s.clone());i.setGizmoOffset(H)}(r),n.clientScale=2,this.recomputePivot()}O=t,l.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(t){this.clearSection(),at(new THREE.Vector3(t.x,t.y,t.z),t.w),O="",l.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(t){O=t||""},this.setDisplaySectionHatches=function(t){Y=t},this.updateCapMeshes=function(t){t&&(at(t.normal,t.constant),U(t))},this.clearSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(n&&n.detach(),i&&i.detach();k.length>0;)k.pop();for(;V.length>0;){var e=V.pop();l.removeOverlay(I,e)}W.start(null),dt(),l.setCutPlaneSet(Q,null,t)},this.isPlaneOn=function(){return R},this.showPlane=function(t){nt(t)},this.attachControl=function(t){n&&i&&(t?(ot(n,V[0].children[0]),n.highlight(),"BOX"===O&&ot(i,V[0])):(n.detach(),i.detach()))},this.resetSection=function(){this.setSection(O)},this.getNames=function(){return h},this.getName=function(){return h[0]},this.register=function(){},this.deregister=function(){this.clearSection(),G&&(l.removeOverlay(I,n),n.removeEventListener("change",L),n=null,l.removeOverlay(I,i),i.removeEventListener("change",L),i.removeEventListener("change",N),i=null,l.removeOverlayScene(I),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,D),t.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,F),t.removeEventListener(Autodesk.Viewing.HIDE_EVENT,F),t.removeEventListener(Autodesk.Viewing.SHOW_EVENT,F),t.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,F),G=!1)},this.getPriority=function(){return 70},this.activate=function(){!function(){if(G)return l.addOverlay(I,n),void l.addOverlay(I,i);(n=new THREE.TransformControls(l.camera,l.canvas,"transrotate")).addEventListener("change",L),n.setSnap(Math.PI/2,Math.PI/36),(i=new THREE.TransformControls(l.camera,l.canvas,"translate")).addEventListener("change",L),i.addEventListener("change",N),void 0===l.overlayScenes.gizmo&&l.createOverlayScene(I),l.addOverlay(I,n),l.addOverlay(I,i),t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,D),t.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,F),t.addEventListener(Autodesk.Viewing.HIDE_EVENT,F),t.addEventListener(Autodesk.Viewing.SHOW_EVENT,F),t.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,F),G=!0}(),E=!0,m=!1,X=!0,k=k||[],it(!0)},this.deactivate=function(){if(E=!1,m=!1,this.keepCutPlanesOnDeactivate){l.removeOverlay(I,n),l.removeOverlay(I,i);for(var t=0;t<V.length;t++)l.removeOverlay(I,V[t])}else W.start(null),dt(),it(!1),l.setCutPlaneSet(Q);n.detach(),i.detach()},this.update=function(){return!1},this.handleSingleClick=function(t){var e,i=Et(t,null===(e=V[0])||void 0===e?void 0:e.children);if(V[0].children.forEach((function(t){t.material.opacity=0})),i){var o,r=n.object;ot(n,i.object),n.highlight(),i.object.material.opacity=k.length>1?.25:0,(null===(o=V[0])||void 0===o?void 0:o.children.length)>1&&r!==i.object&&st(i.object),L(),N()}return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(t){return this.handleSingleClick(t,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(t){return m=!0,!!i.onPointerDown(t)||n.onPointerDown(t)},this.handleButtonUp=function(t){return m=!1,y&&(y=!1,this.recomputePivot()),!!i.onPointerUp(t)||n.onPointerUp(t)},this.handleMouseMove=function(t){var e=i.object?(new THREE.Vector3).copy(i.object.position):null;if(m){if(i.onPointerMove(t)){y=!0,et(),n.update();var o=(new THREE.Vector3).copy(i.object.position).sub(e);return s.add(o),Z("Canvas","Box","translate"),!0}if(n.onPointerMove(t)){if(y=!0,et(),$(),O.includes("BOX"))Z("Canvas","Box","transform");else{var r=-1!=n.axis.search("R")?"rotate":"translate";Z("Canvas","Plane",r)}return!0}}if(i.visible=void 0!==i.object,"touch"!==t.pointerType){var a,c=t,l=Et(c,null===(a=V[0])||void 0===a?void 0:a.children);l&&(X=!1);var u=!!(X||l||Et(c,z,!0));n.visible=u,i.visible=i.visible&&u,nt(u)}return!!i.onPointerHover(t)||n.onPointerHover(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":return j="drag",this.handleButtonDown(t,0);case"dragmove":return"drag"===j&&this.handleMouseMove(t);case"dragend":return"drag"===j&&(j=null,this.handleButtonUp(t,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!1},this.recomputePivot=function(){var t=this.getSectionBoxValues(!0);if(t){var e=t.sectionBox;l.api.navigation.setPivotPoint(new THREE.Vector3(e[0]+.5*(e[3]-e[0]),e[1]+.5*(e[4]-e[1]),e[2]+.5*(e[5]-e[2])))}},this.getSectionBoxValues=function(t){var e=V[0];if(!e)return null;var n=e.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,r=n[2].position.z,a=n[3].position.x,s=n[4].position.y,c=n[5].position.z,u={x:0,y:0,z:0};return t||(u=l.model.getData().globalOffset||u),{sectionBox:[Math.min(a,i)+u.x,Math.min(o,s)+u.y,Math.min(r,c)+u.z,Math.max(a,i)+u.x,Math.max(o,s)+u.y,Math.max(r,c)+u.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(t){var e=V[0];if(!e)return null;var n=e.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};t||(i=l.model.getData().globalOffset||i);var o=n[0].plane,r=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,r]}},this.getSectionPlaneSet=function(){return l.getCutPlaneSet(Q)},this.getSectionPlanes=function(){var t=l.getCutPlaneSet("__set_view");return t.length>0?t:l.getCutPlaneSet(Q)},this.notifyCutplanesChanged=function(){var t=q.length;q.length=0;for(var e=l.getCutPlaneSets(),n=0;n<e.length;n++){var i=e[n];if(i!==Q)for(var o=l.getCutPlaneSet(i),r=0;r<o.length;r++)q.push(o[r])}e.includes("__set_view")&&""!==O&&-1===O.indexOf("OBJ_")&&this.setViewerSection(!1),t!==q.length&&J(!1)},this.notifyRenderOptionChanged=function(){J(!0)},this.setSectionBox=function(t){if(!t)return!1;var e="OBJ_BOX",n=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(t,t.transform);return O=e,l.setCutPlaneSet("__set_view",n),this.setSection(e),!0},this.setSectionPlane=function(t,e){var i,o,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||!e)return!1;var a="OBJ_SET_VIEW_PLANE",s=-1*e.dot(t),c=new THREE.Plane(t,s);O=a;var u=[new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant)];l.setCutPlaneSet("__set_view",u),this.setSection(a),null===(i=n)||void 0===i||i.showRotationGizmos(r);var h=e.clone().sub(V[0].children[0].position);return null===(o=n)||void 0===o||o.setGizmoOffset(h),!0}};var x=n(93379),b=n.n(x),H=n(7795),M=n.n(H),P=n(90569),S=n.n(P),A=n(3565),C=n.n(A),B=n(19216),V=n.n(B),k=n(44589),z=n.n(k),O=n(83427),I={};I.styleTagTransform=z(),I.setAttributes=C(),I.insert=S().bind(null,"head"),I.domAPI=M(),I.insertStyleElement=V();b()(O.Z,I);O.Z&&O.Z.locals&&O.Z.locals;var j=Autodesk.Viewing.Private,G=Autodesk.Viewing.UI,X=j.analytics,_=function(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.viewer=t,this.name="section",this.modes=["x","y","z","box"],this.buttons={},this.onViewerSetView=this.onViewerSetView.bind(this),this._onCutPlanesChanged=this._onCutPlanesChanged.bind(this),this._onShowAll=this._onShowAll.bind(this)};_.prototype=Object.create(Autodesk.Viewing.Extension.prototype),_.prototype.constructor=_;var Y=_.prototype;Y.load=function(){var t=this,e=this,n=this.viewer;this.tool=new R(n,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),n.toolController.registerTool(this.tool,this.setActive.bind(this)),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],this.displaySectionHatches=this.displaySectionHatches.bind(this),this.viewer.prefs.addListeners(j.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),n.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),n.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),n.addEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),n.addEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,e.tool.notifyRenderOptionChanged),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var i=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){if(0===e.viewer.getAggregateSelection().length)return e.deactivate()}}];return n.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,i),this.viewer.registerContextMenuCallback("Autodesk.Section",(function(e,n){!function(t,e,n){var i;if(!n.hasSelected)return;var o=t.viewer,r=o.getAggregateSelection();if(1===r.length&&r[0].model.is2d())return;var a=o.impl.selector.getSelectionBounds(),s={title:"Section",target:[]};s.target.push({title:"Section Box",target:function(){t.setSectionBox(a),X.track("viewer.section",{from:"Contextual",type:"Box",action:"Enable"})}});var c=r.map((function(t){return t.selection})).flat(),l=r.map((function(t){return t.model.id})),u=o.impl.hitTest(n.canvasX,n.canvasY,!1,c,l);if((null==u||null===(i=u.face)||void 0===i?void 0:i.normal)&&u.model&&-1!==c.indexOf(u.dbId)){var h=o.impl.getRenderProxy(u.model,u.fragId),p=(new THREE.Matrix3).getNormalMatrix(h.matrixWorld),E=u.face.normal.clone().applyMatrix3(p).normalize();s.target.push({title:"Section Plane",target:function(){t.setSectionPlane(E,u.point,!1),X.track("viewer.section",{from:"Contextual",type:"Plane",action:"Enable"})}})}e.push(s)}(t,e,n)})),this.viewer.loadExtension("Autodesk.CompGeom")},Y.unload=function(){var t=this.viewer;return t.unregisterContextMenuCallback("Autodesk.Section"),t.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),t.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),t.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),t.removeEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),t.removeEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,this.tool.notifyRenderOptionChanged),this.viewer.prefs.removeListeners(j.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),t.toolController.deregisterTool(this.tool),this.tool=null,!0},Y.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var t=this.sectionStyle||"X";this.setSectionStyle(t,!0)}return this.isActive()},Y.getSectionStyle=function(){return this.sectionStyle},Y.setSectionStyle=function(t,e){if(-1===this.supportedStyles.indexOf(t))return!1;var n=this.isActive(),i=this.sectionStyle!==t||!e;return this.sectionStyle=t,n&&i?this.tool.setSection(t):n||(this.enableSectionTool(!0),i?this.tool.setSection(t):this.tool.attachControl(!0)),!0},Y.setSectionFromPlane=function(t){if(this.deactivate(),t)this.tool.setSectionFromPlane(t),this.tool.attachControl(!1),this.isActive()||this.tool.showPlane(!1);else{this.tool.clearSection();var e=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(e)}},Y.getSectionPlanes=function(){return this.tool.getSectionPlanes()},Y.enableSectionTool=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.viewer.toolController,i=this.tool.isActive();if(t&&!i)return n.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!t&&i){var o=this.tool.keepCutPlanesOnDeactivate;return this.tool.keepCutPlanesOnDeactivate=e,n.deactivateTool("section"),this.tool.keepCutPlanesOnDeactivate=o,this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return t&&n.activateToolModality("section"),!1},Y.getViewValues=function(t){var e=this.tool.getSectionBoxValues(t);if(e)return e;var n=this.tool.getSectionPlaneValues(t);return n||null},Y.getState=function(t){if(this.viewer.model&&!this.viewer.model.is2d()){t.cutplanes=t.cutplanes||[];for(var e=this.tool.getSectionPlaneSet(),n=0;n<e.length;n++)t.cutplanes.push(e[n].toArray())}},Y.restoreState=function(t){if(t.cutplanes){var e=this.getSectionPlanes();return this.setSectionFromPlane(null),1===e.length&&this.setSectionFromPlane(e[0]),!0}},Y._onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},Y._onShowAll=function(){this.deactivate()},Y.setSectionBox=function(t){var e;t&&(this.enableSectionTool(!0),this.tool.setSectionBox(t)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode="box",null===(e=this.buttons[this.mode])||void 0===e||e.setState(G.Button.State.ACTIVE)):this.enableSectionTool(!1))},Y.setSectionPlane=function(t,e,n){var i;t&&e&&(this.enableSectionTool(!0),this.tool.setSectionPlane(t,e,n)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode=this.calculateNearestAxis(t),null===(i=this.buttons[this.mode])||void 0===i||i.setState(G.Button.State.ACTIVE)):this.enableSectionTool(!1))},Y.calculateNearestAxis=function(t){var e=Math.abs(t.x),n=Math.abs(t.y),i=Math.abs(t.z);return e>=n&&e>=i?"x":n>e&&n>=i?"y":"z"},Y.onViewerSetView=function(){this.deactivate()},Y.onToolbarCreated=function(t){this.sectionToolButton=new G.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var e=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(e){var n=e.getControl("toolbar-resetTool");n?e.addControl(this.sectionToolButton,{index:e.indexOf(n.getId())}):e.addControl(this.sectionToolButton,{index:0})}},Y.createSubmenu=function(t){var e=this,n=this.viewer;function i(t,n){return e.buttons[n]=t,function(){var i=t.getState(),o=function(){t instanceof G.ComboButton==!1?e.activate(n):(e.enableSectionTool(!0),e.tool.attachControl(!0))},r=-1!==n.toLowerCase().indexOf("box")?"Box":"Plane";i===G.Button.State.INACTIVE?(t.setState(G.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o(),X.track("viewer.section",{from:"Toolbar",type:r,action:"Enable"})):i===G.Button.State.ACTIVE&&(t.setState(G.Button.State.INACTIVE),e.deactivate(),X.track("viewer.section",{from:"Toolbar",type:r,action:"Disable"})),e.sectionStyle=n.toUpperCase()}}function o(){var t,i=(t=new THREE.Vector3,function(e,n,i){return t.subVectors(e,n),t.lengthSq()<i}),o=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),s=n.autocam.getWorldRightVector(),c=n.autocam.getWorldUpVector(),l=n.autocam.getWorldFrontVector(),u=1e-4;i(c,o,u)?e.sectionYButton.setIcon("adsk-icon-plane-x"):i(c,a,u)?e.sectionYButton.setIcon("adsk-icon-plane-z"):e.sectionYButton.setIcon("adsk-icon-plane-y"),i(s,r,u)?e.sectionXButton.setIcon("adsk-icon-plane-y"):i(s,a,u)?e.sectionXButton.setIcon("adsk-icon-plane-z"):e.sectionXButton.setIcon("adsk-icon-plane-x"),i(l,o,u)?e.sectionZButton.setIcon("adsk-icon-plane-x"):i(l,r,u)?e.sectionZButton.setIcon("adsk-icon-plane-y"):e.sectionZButton.setIcon("adsk-icon-plane-z")}var r=this.sectionXButton=new G.Button("toolbar-sectionTool-x");r.setToolTip("Add X plane"),r.setIcon("adsk-icon-plane-x"),r.onClick=i(r,"x"),t.addControl(r);var a=this.sectionYButton=new G.Button("toolbar-sectionTool-y");a.setToolTip("Add Y plane"),a.setIcon("adsk-icon-plane-y"),a.onClick=i(a,"y"),t.addControl(a);var s=this.sectionZButton=new G.Button("toolbar-sectionTool-z");s.setToolTip("Add Z plane"),s.setIcon("adsk-icon-plane-z"),s.onClick=i(s,"z"),t.addControl(s);var c=this.sectionBoxButton=new G.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=i(c,"box"),t.addControl(c),n.model?o():n.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,o,{once:!0})},Y.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null,this.buttons={})},Y.activate=function(t){if(!this.activeStatus||this.mode!==t){switch(this.enableSectionTool(!0),t){default:this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},Y.deactivate=function(t){return!!this.activeStatus&&(this.tool.setActiveMode(""),this.enableSectionTool(!1,t),this.activeStatus=!1,!0)},Y.displaySectionHatches=function(t){var e=this;if(this.tool.setDisplaySectionHatches(t),this.activeStatus){var n=this.getSectionPlanes();this.tool.clearSection(),n.forEach((function(t){e.tool.updateCapMeshes((new THREE.Plane).setComponents(t.x,t.y,t.z,t.w))}))}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",_)})(),Autodesk.Extensions.Section=i})();
//# sourceMappingURL=Section.min.js.map